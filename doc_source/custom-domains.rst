.. _custom-domains:

#########################
Setting Up Custom Domains
#########################

You can connect a custom domain purchased through domain registrars (for example, Amazon Route 53, GoDaddy, and Google Domains) to your app. When you deploy your web app with the Amplify Console, it is hosted at:

.. code-block:: none

	https://branch-name.d1m7bkiki6tdw1.amplifyapp.com

When you use a custom domain, users see that your app is hosted from a URL, like the following:

.. code-block:: none

	https://www.awesomedomain.com

The Amplify Console issues an SSL certificate for all domains connected to your app so that all traffic is secured through HTTPS/2. The SSL certificate generated by Amazon Certificate Manager is valid for 30 days and renews automatically as long as your app is hosted with Amplify.

.. contents::
   :local:
   :depth: 1


.. _custom-domain-route53:

Adding a Custom Domain Managed in Amazon Route 53
====================================

After you deploy your app, you can add a custom domain that you manage using Amazon Route 53. 

1. On the left navigation pane, choose **App Settings**, **Domain management**, and then choose **Add domain**.

   .. image:: /images/amplify-customdomain-1.png

2. In **Enter your root domain**, enter your root domain (`https://awesomedomain.com`). As you start typing, root domains that you manage in Amazon Route 53 appear in the list (`https://awesomedomain.com`).

3. Select the domain you want to use and then choose **Find Domain** and **Save**. 

   .. image:: /images/amplify-customdomain-2.png

The Amplify Console automatically updates the DNS records for your root (`https://awesomedomain.com`) and www subdomain (`https://www.awesomedomain.com`) in Amazon Route 53. We also set up a redirect for `https://www.awesomedomain.com` to point to `https://awesomedomain.com` (you can change this by choosing **Rewrites and redirects** from the left menu).
     
**Note**  It typically takes 10 to 30 minutes for DNS to propagate and issue the SSL certificate, but it can take up to 24 hours. For more information about the status messages, see :ref:`Associating a Domain <custom-domain-status>`.

.. _custom-domain-third-party:

Adding a Custom Domain Managed by a Third-Party DNS Provider
====================================

After you deploy your app, you can add a custom domain that you manage using a third-party DNS provider if you don't use Amazon Route 53. 

1. On the left navigation pane, choose **App Settings**, **Domain management**, and then choose **Add domain**.

2. In **Enter your root domain**, enter your root domain (`https://awesomedomain.com`) and then choose **Find domain**. If the domain is registered, a green alert notifies you to proceed as long you are the owner of the domain. If the domain is available, purchase a domain at `Amazon Route 53 <https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/domain-register.html>`__.

   .. image:: /images/amplify-customdomain-3.png

3. Choose **Save**. The Amplify Console adds two entries for `https://www.awesomedomain.com` and `https://awesomedomain.com` with a redirect set up from the `www` subdomain to the root domain. Because the domain is managed externally you must manual configure your DNS provider (for example, GoDaddy or Google domains). 
 
4. To assign a domain to your app deployment, choose **View DNS records** in the alert banner. 

   .. image:: /images/amplify-customdomain-4.png

5. Update your DNS providers' CNAME and ALIAS records as follows. For GoDaddy and Google Domains, see the step-by-step instructions in :ref:`Connecting to Third-Party Custom Domains <howto-third-party-domains>`.

   1. Configure CNAME record to point all subdomains (`https://*.awesomedomain.com`) to the amplifyapp domain.  

   2. Configure ANAME/ALIAS record to point the root domain (`https://awesomedomain.com`) to your amplifyapp domain. ANAME records enable you to point the root of your domain to a hostname. For DNS providers that do not have ANAME/ALIAS support, we strongly recommend `migrating your DNS to Amazon Route 53 <https://docs.aws.amazon.com/Route53/latest/DeveloperGuide/dns-configuring.html>`__.

   3. To generate a SSL certificate for your domain, Amazon Certificate Manager (ACM) needs to verify ownership. Configure a CNAME to point to ACM's validation server. Once ACM validates ownership of your domain, all traffic will be served using HTTPS/2. 

      .. image:: /images/amplify-customdomain-5.png

**Important:** Verification of domain ownership and DNS propagation for third-party domains can take up to 48 hours. For more information about status messages, see :ref:`Associating a Domain <custom-domain-status>`.

.. _custom-domain-subdomains:

Managing Subdomains
==============================

A subdomain is the part of your URL that appears before your domain name (for example, `www`.amazon.com or `aws`.amazon.com). For domains managed using Route 53, the Amplify Console automatically creates subdomains for all connected branches. For example, when you connect a `dev` branch, the Amplify Console creates a deployment at `https://dev.<app-id>.amplifyapp.com` without requiring any extra configuration. If you want the same functionality for third-party providers you must configure the DNS. If you want the same functionality for third-party providers, configure the DNS to give Amplify Console wildcard (*) access to all subdomains. 

.. image:: /images/amplify-customdomain-6.png

.. _custom-domain-status:

Associating a Domain
========================

When you are associating a domain with your Amplify app deployment, you see the following status messages:

1. **In Progress** - First attempt at updating your DNS record. This indicates that Amplify is able to update records managed in Route 53, but unable to do so for third-party DNS providers.

2. **Pending verification** - Before issuing an SSL certificate, Amazon Certificate Manager (ACM) must verify that you are the owner of the domain. Domains managed outside Amazon Route 53 usually take the longest time to verify.

3. **Pending deployment** - After domain verification, the DNS is propagated globally to all 144 points of presence of our CDN.

4. **Available** - The domain is successfully associated with your app.
